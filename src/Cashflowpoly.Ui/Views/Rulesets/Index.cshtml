@* Fungsi file: Merender tampilan Razor untuk bagian Rulesets/Index.cshtml beserta interaksi presentasinya. *@
@model Cashflowpoly.Ui.Models.RulesetListViewModel

@{
    ViewData["Title"] = Context.T("nav.ruleset");
    var isInstructor = Context.Session.IsInstructor();
}

<section class="section-shell w-full">
    <div class="page-intro">
        <div class="page-intro-main">
            <p class="eyebrow">@Context.T("rulesets.management")</p>
            <h1 class="headline">@Context.T("rulesets.title")</h1>
            <p class="subhead">@Context.T("rulesets.subtitle")</p>
        </div>
        <div class="page-intro-actions">
            @if (isInstructor)
            {
                <a class="btn-primary"
                   asp-controller="Rulesets" asp-action="Create">@Context.T("rulesets.create")</a>
            }
            else
            {
                <span class="hint-chip">@Context.T("rulesets.readonly_hint")</span>
            }
        </div>
    </div>

    <div class="mt-6 ruleset-unified">
        <div class="ruleset-unified-head">
            <div>
                <p class="text-xs uppercase text-slate-500">@Context.T("rulesets.total_rulesets")</p>
                <p class="mt-1 text-2xl font-semibold text-slate-900">@Model.Items.Count</p>
            </div>
            <p class="text-sm text-slate-600">@Context.T("rulesets.unified_subtitle")</p>
        </div>

        @if (!string.IsNullOrWhiteSpace(Model.ErrorMessage))
        {
            <div class="mt-4 alert alert-error" aria-live="polite">
                @Model.ErrorMessage
            </div>
        }

        <details class="mt-4 data-toggle">
            <summary>@Context.T("rulesets.tips.title")</summary>
            <div class="mt-3 metric-panel">
                <div class="metric-list">
                    <div class="metric-row"><span class="metric-key">@Context.T("sessions.step") 1</span><span class="metric-value">@Context.T("rulesets.tip.create")</span></div>
                    <div class="metric-row"><span class="metric-key">@Context.T("sessions.step") 2</span><span class="metric-value">@Context.T("rulesets.tip.versioning")</span></div>
                    <div class="metric-row"><span class="metric-key">@Context.T("sessions.step") 3</span><span class="metric-value">@Context.T("rulesets.tip.safety")</span></div>
                </div>
            </div>
        </details>

        <div class="mt-6 table-wrap">
            <table class="w-full text-left text-sm mobile-card-table">
                <thead class="table-head">
                    <tr>
                        <th class="px-4 py-3">@Context.T("common.name")</th>
                        <th class="px-4 py-3">@Context.T("common.ruleset_id")</th>
                        <th class="px-4 py-3 text-right">@Context.T("common.latest_version")</th>
                        <th class="px-4 py-3 text-right">@Context.T("common.detail")</th>
                    </tr>
                </thead>
                <tbody>
                @if (Model.Items.Count == 0)
                {
                    <tr>
                        <td class="px-4 py-4 text-slate-500 mobile-card-empty" colspan="4">
                            @Context.T("state.no_rulesets")
                        </td>
                    </tr>
                }
                else
                {
                    foreach (var item in Model.Items)
                    {
                        <tr class="border-t border-slate-200">
                            <td class="px-4 py-3 font-medium text-slate-900" data-label="@Context.T("common.name")">@item.Name</td>
                            <td class="px-4 py-3 font-mono text-xs text-slate-600" data-label="@Context.T("common.ruleset_id")">@item.RulesetId</td>
                            <td class="px-4 py-3 text-right text-slate-700" data-label="@Context.T("common.latest_version")"><span class="version-pill">v@item.LatestVersion</span></td>
                            <td class="px-4 py-3 text-right" data-label="@Context.T("common.detail")">
                                <a class="table-link"
                                   asp-controller="Rulesets" asp-action="Details" asp-route-rulesetId="@item.RulesetId">@Context.T("common.view")</a>
                            </td>
                        </tr>
                    }
                }
                </tbody>
            </table>
        </div>
    </div>
</section>
