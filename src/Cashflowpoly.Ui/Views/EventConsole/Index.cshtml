@model Cashflowpoly.Ui.Models.EventConsoleViewModel

@{
    ViewData["Title"] = "Event Console";
}

<section class="section-shell">
    <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
        <div>
            <p class="eyebrow">Event Console</p>
            <h1 class="headline">Kirim event manual</h1>
            <p class="text-sm text-slate-600">Gunakan untuk backfill event baru seperti <span class="font-semibold">order.passed</span>, <span class="font-semibold">ingredient.discarded</span>, atau <span class="font-semibold">risk.emergency.used</span>. Jika <span class="font-semibold">event_id</span>, <span class="font-semibold">sequence_number</span>, atau <span class="font-semibold">ruleset_version_id</span> kosong, sistem akan mencoba mengisinya otomatis.</p>
        </div>
    </div>

    @if (!string.IsNullOrWhiteSpace(Model.ErrorMessage))
    {
        <div class="mt-4 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">
            @Model.ErrorMessage
        </div>
    }

    @if (!string.IsNullOrWhiteSpace(Model.SuccessMessage))
    {
        <div class="mt-4 rounded-lg border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
            @Model.SuccessMessage
        </div>
    }

    <div class="mt-6 grid gap-6 lg:grid-cols-[2fr,1fr]">
        <div class="glass-panel p-6">
            <form method="post" class="space-y-4">
                <div>
                    <label class="form-label" asp-for="EventJson">Event JSON</label>
                    <textarea class="form-input h-72 font-mono text-xs" asp-for="EventJson"></textarea>
                </div>
                <button class="btn-primary" type="submit">Kirim event</button>
            </form>
        </div>

        <div class="glass-panel p-6 space-y-4">
            <div>
                <p class="text-xs uppercase text-slate-500">Template cepat</p>
                <p class="text-sm text-slate-600">Salin lalu ganti field penting:</p>
            </div>
            <div class="space-y-3 text-xs text-slate-700">
                <div>
                    <p class="font-semibold">order.passed</p>
                    <pre class="whitespace-pre-wrap rounded-lg bg-slate-900/95 p-3 text-[11px] text-slate-100">{"action_type":"order.passed","payload":{"order_card_id":"ORD-002","required_ingredient_card_ids":["ING-002"],"income":12}}</pre>
                </div>
                <div>
                    <p class="font-semibold">ingredient.discarded</p>
                    <pre class="whitespace-pre-wrap rounded-lg bg-slate-900/95 p-3 text-[11px] text-slate-100">{"action_type":"ingredient.discarded","payload":{"card_id":"ING-001","amount":1,"reason":"HAND_LIMIT"}}</pre>
                </div>
                <div>
                    <p class="font-semibold">risk.emergency.used</p>
                    <pre class="whitespace-pre-wrap rounded-lg bg-slate-900/95 p-3 text-[11px] text-slate-100">{"action_type":"risk.emergency.used","payload":{"risk_event_id":"uuid-event","option_type":"SELL_NEED","direction":"IN","amount":3,"note":"Menjual kebutuhan"}}</pre>
                </div>
            </div>
        </div>
    </div>

    @if (!string.IsNullOrWhiteSpace(Model.ResponseJson))
    {
        <div class="mt-6 glass-panel p-6">
            <p class="text-xs uppercase text-slate-500">Response API</p>
            <pre class="mt-3 whitespace-pre-wrap rounded-lg bg-slate-900/95 p-4 text-xs text-slate-100">@Model.ResponseJson</pre>
        </div>
    }
</section>
